<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('head') %>
    <link rel="stylesheet" href="/codemirror/lib/codemirror.css">
  </head>
<body>
  <header>
    <%- include('header') %>
    <h2><% if (isNew) { %>new post<% } else { %><a href="/">/post</a>/<%= slug %> &mdash; edit<% } %></h2>
    <hr>
  </header>
  <main>
    <% if (error) { %>
      <p class="form-error"><%= error %></p>
    <% } %>
    <form method="POST" action="<% if (isNew) { %>/admin/post/new<% } else { %>/admin/post/<%= slug %>/edit<% } %>">

      <% if (isNew) { %>
        <label for="slug">slug</label><br>
        <input type="text" id="slug" name="slug" value="<%= slug %>" pattern="[a-z0-9-]+" placeholder="my-post-slug" required><br><br>
      <% } %>

      <label for="postTitle">title</label><br>
      <input type="text" id="postTitle" name="postTitle" value="<%= postTitle %>"><br><br>

      <label for="tags">tags <span style="color:#666;">(comma-separated)</span></label><br>
      <input type="text" id="tags" name="tags" value="<%= tags %>" placeholder="tag1, tag2"><br><br>

      <label><input type="checkbox" name="draft" value="yes"<% if (draft) { %> checked<% } %>> draft</label><br><br>

      <% if (extraMeta || !isNew) { %>
        <label for="extraMeta">other metadata <span style="color:#666;">(key: value lines)</span></label><br>
        <textarea id="extraMeta" name="extraMeta" rows="4"><%= extraMeta %></textarea><br><br>
      <% } else { %>
        <input type="hidden" name="extraMeta" value="">
      <% } %>

      <hr>

      <label for="content">content</label><br>
      <textarea id="content" name="content" rows="25"><%= content %></textarea><br><br>

      <button type="submit"><% if (isNew) { %>create<% } else { %>save<% } %></button>
      &nbsp;<button type="submit" name="action" value="preview" class="btn-secondary"><% if (isNew) { %>create<% } else { %>save<% } %> as draft &amp; preview</button>
      <% if (!isNew) { %>
        &nbsp;<a href="/post/<%= slug %>">cancel</a>
      <% } %>
    </form>
  </main>
  <script src="/codemirror/lib/codemirror.js"></script>
  <script src="/codemirror/mode/markdown/markdown.js"></script>
  <script>
    CodeMirror.fromTextArea(document.getElementById('content'), {
      mode: 'markdown',
      theme: 'blog',
      lineNumbers: true,
      lineWrapping: true,
    });
  </script>
</body>
</html>
